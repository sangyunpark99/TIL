### DB ëª¨ë‹ˆí„°ë§
DBeaverë¡œ ëª¨ë‹ˆí„°ë§ì„ í•´ì¤ë‹ˆë‹¤.  
![img_9.png](img_9.png)

Servicer Session
ì„œë²„ ì„¸ì…˜ì˜ ì˜ë¯¸ëŠ” í˜„ì¬ ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì—°ê²°ëœ í´ë¼ì´ì–¸íŠ¸ ìˆ˜ë¥¼ ë³´ì—¬ì¤ë‹ˆë‹¤.  

Active : ì‹¤ì§ˆì ìœ¼ë¡œ ë„¤íŠ¸ì›Œí¬ í†µì‹ ì´ ì§„í–‰ë˜ê³  ìˆëŠ” connection
Idle : ë„¤íŠ¸ì›Œí¬ í†µì‹ ì´ ì—†ëŠ” connection í†µì‹ ì„ ëŒ€ê¸°ì¤‘ì¸ connection


Transaction Per Second
ì´ˆë‹¹ íŠ¸ëœì­ì…˜ ìˆ˜ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤.  

Block IO
read : ì‹¤ì œë¡œ ë°ì´í„°ë¥¼ ì½ì–´ì˜¤ëŠ” ë¸”ë¡ì˜ ìˆ˜
hit : ìš”ì²­ëœ ë°ì´í„° ë¸”ë¡ì´ ì´ë¯¸ ë²„í¼ ìºì‹œì— ì¡´ì¬í•´ì„œ ë””ìŠ¤í¬ì— ì ‘ê·¼í•˜ì§€ ì•Šê³ , ë©”ëª¨ë¦¬ì—ì„œ ì§ì ‘ ì œê³µëœ ê²½ìš°

![img_10.png](img_10.png)

#Prometheus
![img_11.png](img_11.png)

ê¸°ë³¸ì ìœ¼ë¡œ í”„ë¡œë©”í…Œìš°ìŠ¤ëŠ” ìµìŠ¤í¬í„°ë¼ëŠ” ê²ƒì„ í†µí•´ì„œ ë§¤íŠ¸ë¦­ì„ ì£¼ê¸°ì ìœ¼ë¡œ ëŒ•ê²¨ì˜¤ëŠ” í’€ ë§¤íŠ¸ë¦­ ë°©ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.

### Grafana
ë‹¤ì–‘í•œ ë°ì´í„° ì†ŒìŠ¤ë¥¼ ì‹œê°í™”í•  ìˆ˜ ìˆëŠ” ëŒ€ì‹œë³´ë“œ ì…ë‹ˆë‹¤.  
í”„ë¡œë©”í…Œìš°ìŠ¤ì—ì„œ ìˆ˜ì§‘ëœ ë°ì´í„°ë„ ì‹œì‘ì ìœ¼ë¡œ ì˜ í‘œí˜„í•´ ì¤ë‹ˆë‹¤.  

docker-composeë¡œ prometheusì™€ grafanaë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.  

ì•„ë˜ì™€ ê°™ì´ docker-composeë¥¼ ì„¤ì •í•´ì¤ë‹ˆë‹¤.
pushgatewayëŠ” prometheusì—ì„œ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.
```yaml
services:
  postgresql:
    image:
      postgres:latest
    restart: always
    volumes: # PostgreSql ì»¨í…Œì´ë„ˆì—ì„œ ë°ì´í„°ë¥¼ ë¡œì»¬ íŒŒì¼ ì‹œìŠ¤í…œì— ì €ì¥í•˜ì—¬ ì»¨í…Œì´ë„ˆ ì‚­ì œ í›„ì—ë„ ë°ì´í„° ìœ ì§€
      - ./data/ecommerce-db:/var/lib/postgresql/data
    ports:
      - "5433:5432"
    shm_size: 128mb
    environment:
      POSTGRES_PASSWORD: localpw

  prometheus:
    image: prom/prometheus:latest
    restart: always
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    ports:
      - "9090:9090"

  pushgateway:
    image: prom/pushgateway:latest
    restart: always
    ports:
      - "9091:9091"

  grafana:
    image: grafana/grafana:latest
    restart: always
    ports:
      - "3000:3000"
```

ì£¼ì–´ì§„ JSONíŒŒì¼ì„ ì‚¬ìš©í•´ì„œ grafanaì— JSONì„ ë„£ì–´ì¤ë‹ˆë‹¤. 
```java
{
  "annotations": {
    "list": [
      {
        "builtIn": 1,
        "datasource": "-- Grafana --",
        "enable": true,
        "hide": true,
        "iconColor": "rgba(0, 211, 255, 1)",
        "limit": 100,
        "name": "Annotations & Alerts",
        "showIn": 0,
        "type": "dashboard"
      }
    ]
  },
  "description": "Dashboard for Spring Batch applications instrumented with Micrometer",
  "editable": true,
  "gnetId": 4701,
  "graphTooltip": 1,
  "id": 1,
  "iteration": 1727106676361,
  "links": [],
  "panels": [
    {
      "collapsed": false,
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 132,
      "panels": [],
      "repeat": null,
      "title": "Spring Batch Metrics",
      "type": "row"
    },
    {
      "aliasColors": {},
      "bars": false,
      "dashLength": 10,
      "dashes": false,
      "datasource": "Prometheus",
      "editable": true,
      "error": false,
      "fill": 1,
      "grid": {
        "leftLogBase": 1,
        "leftMax": null,
        "leftMin": null,
        "rightLogBase": 1,
        "rightMax": null,
        "rightMin": null
      },
      "gridPos": {
        "h": 7,
        "w": 12,
        "x": 0,
        "y": 1
      },
      "id": 38,
      "legend": {
        "avg": false,
        "current": false,
        "max": false,
        "min": false,
        "show": true,
        "total": false,
        "values": false
      },
      "lines": true,
      "linewidth": 1,
      "links": [],
      "nullPointMode": "null",
      "paceLength": 10,
      "percentage": false,
      "pointradius": 5,
      "points": false,
      "renderer": "flot",
      "seriesOverrides": [],
      "spaceLength": 10,
      "stack": false,
      "steppedLine": false,
      "targets": [
        {
          "expr": "spring_batch_job_seconds_max{job_name=\"$job_name\"}",
          "format": "time_series",
          "hide": false,
          "interval": "",
          "intervalFactor": 2,
          "legendFormat": "{{ job_name }}",
          "metric": "",
          "refId": "A",
          "step": 1200
        }
      ],
      "thresholds": [],
      "timeFrom": null,
      "timeRegions": [],
      "timeShift": null,
      "title": "Job Execution Time",
      "tooltip": {
        "msResolution": false,
        "shared": true,
        "sort": 0,
        "value_type": "cumulative"
      },
      "type": "graph",
      "x-axis": true,
      "xaxis": {
        "buckets": null,
        "mode": "time",
        "name": null,
        "show": true,
        "values": []
      },
      "y-axis": true,
      "y_formats": [
        "ops",
        "short"
      ],
      "yaxes": [
        {
          "decimals": null,
          "format": "ms",
          "label": "",
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        },
        {
          "format": "short",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        }
      ],
      "yaxis": {
        "align": false,
        "alignLevel": null
      }
    },
    {
      "aliasColors": {},
      "bars": false,
      "dashLength": 10,
      "dashes": false,
      "datasource": "Prometheus",
      "fill": 1,
      "gridPos": {
        "h": 7,
        "w": 12,
        "x": 12,
        "y": 1
      },
      "id": 138,
      "legend": {
        "avg": false,
        "current": false,
        "max": false,
        "min": false,
        "show": true,
        "total": false,
        "values": false
      },
      "lines": true,
      "linewidth": 1,
      "links": [],
      "nullPointMode": "null",
      "paceLength": 10,
      "percentage": false,
      "pointradius": 5,
      "points": false,
      "renderer": "flot",
      "seriesOverrides": [],
      "spaceLength": 10,
      "stack": false,
      "steppedLine": false,
      "targets": [
        {
          "expr": "spring_batch_step_seconds_max{job_name=\"$job_name\"}",
          "format": "time_series",
          "hide": false,
          "instant": false,
          "intervalFactor": 1,
          "legendFormat": "{{spring_batch_step_name}}",
          "refId": "A"
        }
      ],
      "thresholds": [],
      "timeFrom": null,
      "timeRegions": [],
      "timeShift": null,
      "title": "Step Execution Time",
      "tooltip": {
        "shared": true,
        "sort": 0,
        "value_type": "individual"
      },
      "type": "graph",
      "xaxis": {
        "buckets": null,
        "mode": "time",
        "name": null,
        "show": true,
        "values": []
      },
      "yaxes": [
        {
          "format": "ms",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        },
        {
          "format": "short",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        }
      ],
      "yaxis": {
        "align": false,
        "alignLevel": null
      }
    },
    {
      "aliasColors": {},
      "bars": false,
      "dashLength": 10,
      "dashes": false,
      "datasource": "Prometheus",
      "editable": true,
      "error": false,
      "fill": 1,
      "grid": {
        "leftLogBase": 1,
        "leftMax": null,
        "leftMin": null,
        "rightLogBase": 1,
        "rightMax": null,
        "rightMin": null
      },
      "gridPos": {
        "h": 7,
        "w": 8,
        "x": 0,
        "y": 8
      },
      "id": 37,
      "legend": {
        "alignAsTable": false,
        "avg": false,
        "current": false,
        "hideEmpty": false,
        "hideZero": false,
        "max": false,
        "min": false,
        "rightSide": false,
        "show": true,
        "total": false,
        "values": false
      },
      "lines": true,
      "linewidth": 1,
      "links": [],
      "nullPointMode": "null",
      "paceLength": 10,
      "percentage": false,
      "pointradius": 5,
      "points": false,
      "renderer": "flot",
      "seriesOverrides": [],
      "spaceLength": 10,
      "stack": false,
      "steppedLine": false,
      "targets": [
        {
          "expr": "spring_batch_item_read_seconds_max{job_name=\"$job_name\"}",
          "format": "time_series",
          "interval": "",
          "intervalFactor": 1,
          "legendFormat": "{{spring_batch_item_read_step_name}} ",
          "metric": "",
          "refId": "A",
          "step": 1200
        }
      ],
      "thresholds": [],
      "timeFrom": null,
      "timeRegions": [],
      "timeShift": null,
      "title": "Item Read Execution Time",
      "tooltip": {
        "msResolution": false,
        "shared": true,
        "sort": 0,
        "value_type": "cumulative"
      },
      "type": "graph",
      "x-axis": true,
      "xaxis": {
        "buckets": null,
        "mode": "time",
        "name": null,
        "show": true,
        "values": []
      },
      "y-axis": true,
      "y_formats": [
        "short",
        "short"
      ],
      "yaxes": [
        {
          "format": "s",
          "label": "",
          "logBase": 1,
          "max": null,
          "min": 0,
          "show": true
        },
        {
          "format": "short",
          "label": "",
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        }
      ],
      "yaxis": {
        "align": false,
        "alignLevel": null
      }
    },
    {
      "aliasColors": {},
      "bars": false,
      "dashLength": 10,
      "dashes": false,
      "datasource": "Prometheus",
      "editable": true,
      "error": false,
      "fill": 1,
      "grid": {
        "leftLogBase": 1,
        "leftMax": null,
        "leftMin": null,
        "rightLogBase": 1,
        "rightMax": null,
        "rightMin": null
      },
      "gridPos": {
        "h": 7,
        "w": 8,
        "x": 8,
        "y": 8
      },
      "id": 142,
      "legend": {
        "alignAsTable": false,
        "avg": false,
        "current": false,
        "hideEmpty": false,
        "hideZero": false,
        "max": false,
        "min": false,
        "rightSide": false,
        "show": true,
        "total": false,
        "values": false
      },
      "lines": true,
      "linewidth": 1,
      "links": [],
      "nullPointMode": "null",
      "paceLength": 10,
      "percentage": false,
      "pointradius": 5,
      "points": false,
      "renderer": "flot",
      "seriesOverrides": [],
      "spaceLength": 10,
      "stack": false,
      "steppedLine": false,
      "targets": [
        {
          "expr": "spring_batch_item_process_seconds_max{job_name=\"$job_name\"}",
          "format": "time_series",
          "intervalFactor": 1,
          "legendFormat": "{{spring_batch_item_process_step_name}} ",
          "refId": "B"
        }
      ],
      "thresholds": [],
      "timeFrom": null,
      "timeRegions": [],
      "timeShift": null,
      "title": "Item Process Execution Time",
      "tooltip": {
        "msResolution": false,
        "shared": true,
        "sort": 0,
        "value_type": "cumulative"
      },
      "type": "graph",
      "x-axis": true,
      "xaxis": {
        "buckets": null,
        "mode": "time",
        "name": null,
        "show": true,
        "values": []
      },
      "y-axis": true,
      "y_formats": [
        "short",
        "short"
      ],
      "yaxes": [
        {
          "format": "s",
          "label": "",
          "logBase": 1,
          "max": null,
          "min": 0,
          "show": true
        },
        {
          "format": "short",
          "label": "",
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        }
      ],
      "yaxis": {
        "align": false,
        "alignLevel": null
      }
    },
    {
      "aliasColors": {},
      "bars": false,
      "dashLength": 10,
      "dashes": false,
      "datasource": "Prometheus",
      "editable": true,
      "error": false,
      "fill": 1,
      "grid": {
        "leftLogBase": 1,
        "leftMax": null,
        "leftMin": null,
        "rightLogBase": 1,
        "rightMax": null,
        "rightMin": null
      },
      "gridPos": {
        "h": 7,
        "w": 8,
        "x": 16,
        "y": 8
      },
      "id": 143,
      "legend": {
        "alignAsTable": false,
        "avg": false,
        "current": false,
        "hideEmpty": false,
        "hideZero": false,
        "max": false,
        "min": false,
        "rightSide": false,
        "show": true,
        "total": false,
        "values": false
      },
      "lines": true,
      "linewidth": 1,
      "links": [],
      "nullPointMode": "null",
      "paceLength": 10,
      "percentage": false,
      "pointradius": 5,
      "points": false,
      "renderer": "flot",
      "seriesOverrides": [],
      "spaceLength": 10,
      "stack": false,
      "steppedLine": false,
      "targets": [
        {
          "expr": "spring_batch_chunk_write_seconds_max{job_name=\"$job_name\"}",
          "format": "time_series",
          "intervalFactor": 1,
          "legendFormat": "{{spring_batch_chunk_write_step_name}} ",
          "refId": "C"
        }
      ],
      "thresholds": [],
      "timeFrom": null,
      "timeRegions": [],
      "timeShift": null,
      "title": "Item Write Execution Time",
      "tooltip": {
        "msResolution": false,
        "shared": true,
        "sort": 0,
        "value_type": "cumulative"
      },
      "type": "graph",
      "x-axis": true,
      "xaxis": {
        "buckets": null,
        "mode": "time",
        "name": null,
        "show": true,
        "values": []
      },
      "y-axis": true,
      "y_formats": [
        "short",
        "short"
      ],
      "yaxes": [
        {
          "format": "s",
          "label": "",
          "logBase": 1,
          "max": null,
          "min": 0,
          "show": true
        },
        {
          "format": "short",
          "label": "",
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        }
      ],
      "yaxis": {
        "align": false,
        "alignLevel": null
      }
    },
    {
      "aliasColors": {},
      "bars": false,
      "dashLength": 10,
      "dashes": false,
      "fill": 1,
      "gridPos": {
        "h": 9,
        "w": 8,
        "x": 0,
        "y": 15
      },
      "id": 141,
      "legend": {
        "avg": false,
        "current": false,
        "max": false,
        "min": false,
        "show": true,
        "total": false,
        "values": false
      },
      "lines": true,
      "linewidth": 1,
      "links": [],
      "nullPointMode": "null",
      "paceLength": 10,
      "percentage": false,
      "pointradius": 5,
      "points": false,
      "renderer": "flot",
      "seriesOverrides": [
        {
          "alias": "write success",
          "yaxis": 1
        }
      ],
      "spaceLength": 10,
      "stack": false,
      "steppedLine": false,
      "targets": [
        {
          "expr": "spring_batch_item_read_seconds_count{job_name=\"$job_name\"}",
          "format": "time_series",
          "interval": "",
          "intervalFactor": 1,
          "legendFormat": "{{spring_batch_item_read_step_name}}",
          "refId": "B"
        }
      ],
      "thresholds": [],
      "timeFrom": null,
      "timeRegions": [],
      "timeShift": null,
      "title": "Item Read Count",
      "tooltip": {
        "shared": true,
        "sort": 0,
        "value_type": "individual"
      },
      "type": "graph",
      "xaxis": {
        "buckets": null,
        "mode": "time",
        "name": null,
        "show": true,
        "values": []
      },
      "yaxes": [
        {
          "format": "ops",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        },
        {
          "format": "ops",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        }
      ],
      "yaxis": {
        "align": false,
        "alignLevel": null
      }
    },
    {
      "aliasColors": {},
      "bars": false,
      "dashLength": 10,
      "dashes": false,
      "fill": 1,
      "gridPos": {
        "h": 9,
        "w": 8,
        "x": 8,
        "y": 15
      },
      "id": 144,
      "legend": {
        "avg": false,
        "current": false,
        "max": false,
        "min": false,
        "show": true,
        "total": false,
        "values": false
      },
      "lines": true,
      "linewidth": 1,
      "links": [],
      "nullPointMode": "null",
      "paceLength": 10,
      "percentage": false,
      "pointradius": 5,
      "points": false,
      "renderer": "flot",
      "seriesOverrides": [
        {
          "alias": "write success",
          "yaxis": 1
        }
      ],
      "spaceLength": 10,
      "stack": false,
      "steppedLine": false,
      "targets": [
        {
          "expr": "spring_batch_item_process_seconds_count{job_name=\"$job_name\"}",
          "format": "time_series",
          "interval": "",
          "intervalFactor": 1,
          "legendFormat": "{{spring_batch_item_process_step_name}}",
          "refId": "B"
        }
      ],
      "thresholds": [],
      "timeFrom": null,
      "timeRegions": [],
      "timeShift": null,
      "title": "Item Process Count",
      "tooltip": {
        "shared": true,
        "sort": 0,
        "value_type": "individual"
      },
      "type": "graph",
      "xaxis": {
        "buckets": null,
        "mode": "time",
        "name": null,
        "show": true,
        "values": []
      },
      "yaxes": [
        {
          "format": "ops",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        },
        {
          "format": "ops",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        }
      ],
      "yaxis": {
        "align": false,
        "alignLevel": null
      }
    },
    {
      "aliasColors": {},
      "bars": false,
      "dashLength": 10,
      "dashes": false,
      "fill": 1,
      "gridPos": {
        "h": 9,
        "w": 8,
        "x": 16,
        "y": 15
      },
      "id": 140,
      "legend": {
        "avg": false,
        "current": false,
        "max": false,
        "min": false,
        "show": true,
        "total": false,
        "values": false
      },
      "lines": true,
      "linewidth": 1,
      "links": [],
      "nullPointMode": "null",
      "paceLength": 10,
      "percentage": false,
      "pointradius": 5,
      "points": false,
      "renderer": "flot",
      "seriesOverrides": [
        {
          "alias": "write success",
          "yaxis": 1
        }
      ],
      "spaceLength": 10,
      "stack": false,
      "steppedLine": false,
      "targets": [
        {
          "expr": "spring_batch_chunk_write_seconds_count{job_name=\"$job_name\"}",
          "format": "time_series",
          "interval": "",
          "intervalFactor": 1,
          "legendFormat": "{{spring_batch_chunk_write_step_name}}",
          "refId": "B"
        }
      ],
      "thresholds": [],
      "timeFrom": null,
      "timeRegions": [],
      "timeShift": null,
      "title": "Item Write Count",
      "tooltip": {
        "shared": true,
        "sort": 0,
        "value_type": "individual"
      },
      "type": "graph",
      "xaxis": {
        "buckets": null,
        "mode": "time",
        "name": null,
        "show": true,
        "values": []
      },
      "yaxes": [
        {
          "format": "ops",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        },
        {
          "format": "ops",
          "label": null,
          "logBase": 1,
          "max": null,
          "min": null,
          "show": true
        }
      ],
      "yaxis": {
        "align": false,
        "alignLevel": null
      }
    }
  ],
  "refresh": "5s",
  "schemaVersion": 18,
  "style": "dark",
  "tags": [],
  "templating": {
    "list": [
      {
        "allValue": null,
        "current": {
          "tags": [],
          "text": "productUploadJob",
          "value": "productUploadJob"
        },
        "datasource": "Prometheus",
        "definition": "label_values(spring_batch_job_seconds_max, job_name)",
        "hide": 0,
        "includeAll": false,
        "label": "job_name",
        "multi": false,
        "name": "job_name",
        "options": [
          {
            "selected": true,
            "text": "productUploadJob",
            "value": "productUploadJob"
          }
        ],
        "query": "label_values(spring_batch_job_seconds_max, job_name)",
        "refresh": 0,
        "regex": "",
        "skipUrlSync": false,
        "sort": 0,
        "tagValuesQuery": "",
        "tags": [],
        "tagsQuery": "",
        "type": "query",
        "useTags": false
      }
    ]
  },
  "time": {
    "from": "now-15m",
    "to": "now"
  },
  "timepicker": {
    "now": true,
    "refresh_intervals": [
      "5s",
      "10s",
      "30s",
      "1m",
      "5m",
      "15m",
      "30m",
      "1h",
      "2h",
      "1d"
    ],
    "time_options": [
      "5m",
      "15m",
      "1h",
      "6h",
      "12h",
      "24h",
      "2d",
      "7d",
      "30d"
    ]
  },
  "timezone": "browser",
  "title": "Spring Batch Prometheus",
  "uid": "qRLUmOCmk",
  "version": 2
}
```
![img_12.png](img_12.png)
ì´ëŸ°ì‹ìœ¼ë¡œ í™”ë©´ì´ ìƒì„±ë©ë‹ˆë‹¤.  

grafanaìª½ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì¤„ ìˆ˜ ìˆê²Œ ë©”íŠ¸ë¦­ ë°ì´í„°ë“¤ì„ í‘¸ì‰¬í•  ìˆ˜ ìˆê²Œ í•´ì¤ë‹ˆë‹¤.  

![img_13.png](img_13.png)
prometheus

![img_14.png](img_14.png)
pushgatewayë„ ë„£ì–´ì¤ë‹ˆë‹¤.  

![img_15.png](img_15.png)
ì»¤ìŠ¤í„°ë§ˆì´ì§•ì„ í•˜ë ¤ë©´ PrometheusPushGatewayMangerë¥¼ ìˆ˜ì •í•´ì¤ë‹ˆë‹¤.  

Jobì´ ëë‚ ë•Œ putMatricsë¡œ ë°ì´í„°ë¥¼ ë„£ì–´ì¤ë‹ˆë‹¤.
```java
package org.example.batch.service.monitoring;

import java.util.Map;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.batch.core.JobExecution;
import org.springframework.batch.core.JobExecutionListener;
import org.springframework.stereotype.Component;

@Slf4j
@Component
@RequiredArgsConstructor
public class BatchJobExecutionListener implements JobExecutionListener { // Job ì‹¤í–‰ ì‹œì‘, ì¢…ë£Œ ë¶€ë¶„ë§Œ ê°€ì ¸ì˜µë‹ˆë‹¤.

  private final CustomPrometheusPushGatewayManager manager;

  @Override
  public void beforeJob(JobExecution jobExecution) { // Job ì‹œì‘ ì „
    log.info("listener: before job");
  }

  @Override
  public void afterJob(JobExecution jobExecution) { // Job ì‹œì‘ í›„
    log.info("listener: after job {}", jobExecution.getExecutionContext());

    manager.pushMetrics(Map.of("job_name", jobExecution.getJobInstance().getJobName()));
  }
}
```

Stepì´ ëë‚ ë•Œ putMetricsë¡œ ë°ì´í„°ë¥¼ ë„£ì–´ì¤ë‹ˆë‹¤.  
```java
package org.example.batch.service.monitoring;

import java.util.Map;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.batch.core.ExitStatus;
import org.springframework.batch.core.StepExecution;
import org.springframework.batch.core.StepExecutionListener;
import org.springframework.stereotype.Component;

@Slf4j
@Component
@RequiredArgsConstructor
public class BatchStepExecutionListener implements StepExecutionListener {

  private final CustomPrometheusPushGatewayManager manager;

  @Override
  public ExitStatus afterStep(StepExecution stepExecution) {
    log.info("after step - execution context: {}", stepExecution.getExecutionContext());
    manager.pushMetrics(
        Map.of("job_name", stepExecution.getJobExecution().getJobInstance().getJobName()));
    return ExitStatus.COMPLETED;
  }
}

```

![img_16.png](img_16.png)]

```
ğŸš€ @AutoConfigureObservability ì–´ë…¸í…Œì´ì…˜ ê°œìš”
@AutoConfigureObservabilityëŠ” Spring Bootì—ì„œ Observability(ê´€ì¸¡ì„±) ê´€ë ¨ ìë™ ì„¤ì •ì„ í™œì„±í™”í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜ì´ì•¼.

ğŸ”¹ ì£¼ë¡œ Spring Bootì˜ í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ Observability(ê´€ì¸¡ì„±) ê¸°ëŠ¥ì„ ì„¤ì •í•  ë•Œ ì‚¬ìš©ë¨.
ğŸ”¹ spring-boot-test-autoconfigure íŒ¨í‚¤ì§€ì—ì„œ ì œê³µí•˜ë©°,
Prometheus, Micrometer, OpenTelemetry ê°™ì€ ëª¨ë‹ˆí„°ë§ ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ í•¨ê»˜ ì“°ì¼ ìˆ˜ ìˆìŒ.
```

```java
package org.example.batch.jobconfig.product.upload;

import static org.assertj.core.api.Assertions.assertThat;
import static org.junit.jupiter.api.Assertions.assertAll;

import java.io.IOException;
import org.example.batch.BaseBatchIntegrationTest;
import org.example.batch.BatchApplication;
import org.example.batch.service.product.ProductService;
import org.junit.jupiter.api.Test;
import org.springframework.batch.core.Job;
import org.springframework.batch.core.JobExecution;
import org.springframework.batch.core.JobParameter;
import org.springframework.batch.core.JobParameters;
import org.springframework.batch.core.JobParametersBuilder;
import org.springframework.batch.test.context.SpringBatchTest;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.boot.test.autoconfigure.actuate.observability.AutoConfigureObservability;
import org.springframework.core.io.Resource;
import org.springframework.test.context.TestPropertySource;
import org.springframework.test.context.jdbc.Sql;
import org.springframework.test.context.junit.jupiter.SpringJUnitConfig;

@AutoConfigureObservability
@Sql("/sql/schema.sql")
@SpringBatchTest
@SpringJUnitConfig(classes = {BatchApplication.class})
@TestPropertySource(properties = {"spring.batch.job.name=productUploadJob"})
class ProductUploadJobConfigurationTest extends BaseBatchIntegrationTest {

  @Value("classpath:/data/products_for_upload.csv")
  private Resource input;

  @Autowired
  private ProductService productService;

  @Test
  void testJob(@Autowired Job productUploadJob) throws Exception {
    JobParameters jobParameter = jobParameters();
    jobLauncherTestUtils.setJob(productUploadJob);

    JobExecution jobExecution = jobLauncherTestUtils.launchJob(jobParameter);

    assertAll(
        () -> assertThat(productService.countProduct()).isEqualTo(6),
        () -> assertJobCompleted(jobExecution)
    );
  }

  private JobParameters jobParameters() throws IOException {
    return new JobParametersBuilder()
        .addJobParameter("inputFilePath",
            new JobParameter<>(input.getFile().getAbsolutePath(), String.class, false))
        .toJobParameters();
  }
}
```
ëª¨ë‹ˆí„°ë§ ì‚¬ìš©ì‹œ bean ì£¼ì… ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤ë©´,
@AutoConfigureObservabilityë¥¼ ì‚¬ìš©í•´ì£¼ë©´ ëœë‹¤.